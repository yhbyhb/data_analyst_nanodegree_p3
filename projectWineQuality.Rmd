Wine Quality Reds Exploration by HanByul Yang
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
knitr::opts_chunk$set(comment = NA, echo=FALSE, message = FALSE, warnings = FALSE)
# Loading required libraries
library(ggplot2)
library(GGally)
library(scales)
library(memisc)
library(knitr)
library(dplyr)
library(gridExtra)
library(psych)
theme_set(theme_minimal(20))
```

```{r echo=FALSE, Load_the_Data}
# Loading the Data
df <- read.csv('wineQualityReds.csv')

# Remove unnecessary column "X" which indicates index.
drops <- c("X")
wineQuality <- df[, !(names(df) %in% drops)]
```

# Summary of the data set
```{r echo=FALSE, Summary}
# Summarize the data set
dim(wineQuality)
names(wineQuality)
str(wineQuality)
summary(wineQuality)
```

1. Data set consists of 1599 red wine and have 11 input attributes and 1 output attributes.
1. The quality is varies from 3 to 8 with median 6.
1. The alcohol is varies from 8.4% to 14.9%.
1. The median qulity of red wine is 6. median residual.sugar is 2.2 g / dm^3.
median alcohol of red wine is 10.2 %.

# Univariate Plots Section

```{r echo=FALSE, fixed.acidity}
qplot(fixed.acidity, data = wineQuality)
qplot(fixed.acidity, data = wineQuality, binwidth=0.2)
```

Most red wines have fixed acidity between 7.10 g/dm^3 and  9.20 g/dm^3.

```{r echo=FALSE, volatile.acidity}
qplot(volatile.acidity, data = wineQuality)
qplot(volatile.acidity, data = wineQuality, binwidth = 0.025) +
  coord_cartesian(xlim=c(0, 1.4))
```

Most red wines have volatile acidity between 039 g/dm^3 and 0.64 g/dm^3. There are some outliers above 1.5

```{r echo=FALSE, citric.acid}
qplot(citric.acid, data = wineQuality)
qplot(citric.acid, data = wineQuality, binwidth = 0.03)
table(wineQuality$citric.acid == 0)
```

```{r echo=FALSE, table_citric.acid}
summary(wineQuality$citric.acid)
sort(table(wineQuality$citric.acid), decreasing = T)
```

The citric acid has three peaks around 0, 0.25 and 0.5g/dm^3.
138 red wines have 0 g/dm^3 citric acid. There is an outlier that has 1.0 g/dm^3.

```{r echo=FALSE, residual.sugar}
qplot(residual.sugar, data = wineQuality)
qplot(residual.sugar, data = wineQuality, binwidth = 0.1) + 
  coord_cartesian(xlim=c(0, 16))
qplot(residual.sugar, data = wineQuality) + 
  scale_x_log10()
summary(wineQuality$residual.sugar)
```

The histotram of residual sugar has one peak and long-tailed.
Most of red wines have residual sugar between 1.9 g/dm^3 to 2.6 g/dm^3: median 2.2g/dm^3 and mean 2.539 g/dm^3.

```{r echo=FALSE, chlorides}
qplot(chlorides, data = wineQuality, binwidth = 0.005)
qplot(chlorides, data = wineQuality, binwidth = 0.005) + 
  coord_cartesian(xlim=c(0, 0.25))
qplot(chlorides, data = wineQuality, binwidth = 0.02) +
  scale_x_log10(breaks = c(0.01, 0.025, 0.05, 0.1, 0.2, 0.5))
summary(wineQuality$chlorides)
```

Most of red wines have chlorides between 0.07 g/dm^3 to 0.09 g/dm^3: median 0.079 g/dm^3 and mean 0.08747 g/dm^3. 
Transform x axis with log10, histogram of chlorides seems to have a normal distribution.

```{r echo=FALSE, free.sulfur.dioxide}
qplot(free.sulfur.dioxide, data = wineQuality)
qplot(free.sulfur.dioxide, data = wineQuality, binwidth = 0.5)
summary(wineQuality$free.sulfur.dioxide)
```

Most free.sulfur.dioxide values are integers and most of them are between 7 mg/dm^3 and 21 mg/dm^3.

```{r echo=FALSE, total.sulfur.dioxide}
qplot(total.sulfur.dioxide, data = wineQuality, binwidth = 5)
qplot(total.sulfur.dioxide, data = wineQuality, binwidth = 0.5) + 
  coord_cartesian(xlim=c(0, 180))
summary(wineQuality$total.sulfur.dioxide)
```

All of total.sulfur.dioxide values are integers. Most red wines have a total.sulfur.dioxide between 22 mg/dm^3 and 62 mg/dm^3. There are some outliers above 250 mg/dm^3.

```{r echo=FALSE, density}
qplot(density, data = wineQuality)
qplot(density, data = wineQuality, binwidth = 0.0005)
```

The density value seems to display a normal distribution with major values between 0.995 and 1.0.

```{r echo=FALSE, pH}
qplot(pH, data = wineQuality)
```

The pH also seems to have a normal distribution.
Most of red wines have a pH between 3.21 and 3.4: median 3.31 and mean 3.311.

```{r echo=FALSE, sulphates}
qplot(sulphates, data = wineQuality)
qplot(sulphates, data = wineQuality, binwidth = 0.05)
```

The sulphates has outliers above 1.5 g/dm^3 and has peak around 0.6.

```{r echo=FALSE, alcohol}
qplot(alcohol, data = wineQuality)
qplot(alcohol, data = wineQuality, binwidth = 0.1)
```

The alcohol varies between 8 to 14 with major peaks around 10.
Most of red wines have a alcohol between 9.5 and 11.1: median 10.2 and mean 10.42.

```{r echo=FALSE, quality}
qplot(x = quality, data = wineQuality)
summary(wineQuality$quality)
sort(table(wineQuality$quality), decreasing = T)
```

All of quality values are integers and between 3 and 8.
Most of red wines have a quality between 5 and 6: median 6 and mean 5.636

```{r echo=FALSE, factor_quality}
# quality are integers and between 3 and 8.
wineQuality$quality_class <- factor(wineQuality$quality, labels = c(3:8))
levels(wineQuality$quality_class)
summary(wineQuality$quality_class)
qplot(quality_class, data = wineQuality, geom="bar")
```

Created "quality_class" factord variable for bi and multivariate analysis.

# Univariate Analysis

### What is the structure of your dataset?
There are 1599 red wines and have 11 input features and 1 output feature(quality).

### What is/are the main feature(s) of interest in your dataset?
The main features in the data set is quality. I'd like to find which chemical properties influence the quality of red wine. I suspect alcohol and some other features can be used to build a pridictive model to quality of red wine.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
Alcohol, density and pH seems to contribute the quality. I think alcohol is most significant feature because red wine is a kind of liquor.

### Did you create any new variables from existing variables in the dataset?
Yes, I created "quality_class" variable for bivariate or multivariate analysis of "quality" feature.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
The citric acid has three peaks around 0, 0.25 and 0.5g/dm^3.
138 red wines have 0 g/dm^3 citric acid which is the highest peak. 

The chlorides is log-transformed. the transformed distribution shows normal distribution. Most of red wines have chlorides between 0.07 g/dm^3 to 0.09 g/dm^3: median 0.079 g/dm^3 and mean 0.08747 g/dm^3. 

# Bivariate Plots Section
```{r echo=FALSE, Correlation_matrix}
#Generate correlation matrix except 'quality_class' which is duplicated with 
#'quality'. Use from Column 1 to Column 12.
cor(wineQuality[, c(1:12)])
```

The alcohol and sulphates are the most correlated features with quality. The volatile.acidity is negatively correlated with quality.

```{r echo=FALSE, Pairs_Panel}
pairs.panels(wineQuality[, c(1:12)])
```

```{r echo=FALSE, quality_vs_alcohol}
qplot(x = quality, y = alcohol, data = wineQuality)
ggplot(aes(x = quality, y = alcohol), data = wineQuality) +
  geom_jitter(colour = 'black', fill = 'black',  alpha = 1/10, pch=21, cex=4)
ggplot(aes(x = quality, y = alcohol), data = wineQuality) +
  geom_line(stat='summary',fun.y=median)
```

```{r echo=FALSE, quality_class_vs_alcohol}
qplot(x = quality_class, y = alcohol, data = wineQuality, geom="boxplot")
```

```{r echo=FALSE, alchol_and_quality}
qplot(x = alcohol, data = wineQuality) +
  facet_wrap(~quality_class)
ggplot(aes(x = alcohol), data = wineQuality) +
  geom_density()  +
  facet_wrap(~quality)
```

As quality increases, median of alcohol tends to increse.

```{r echo=FALSE, alcohol_vs_quality_linear_model}
# linear model for alcohol and quality. Remove outlier exceed 0.999
wineSubset = subset(wineQuality,
                    alcohol <= quantile(wineQuality$alcohol, 0.999))
qplot(x = alcohol, y = quality, color = I('black'), alpha = I(1/10),
      data = wineSubset) +
  geom_smooth(method = 'lm', se = T, color = 'blue')

# linear model for alcohol and quality. Remove outlier exceed 0.999
alcoholQualityLM <- lm(quality ~ alcohol,
                       data = wineSubset)
summary(alcoholQualityLM)
```

The linear model of alcohol and quality has R^2 value 0.2314.

```{r echo=FALSE, alcohol_vs_density}
qplot(x = alcohol, y = density, data = wineQuality)
ggplot(aes(x = alcohol, y = density), data = wineQuality) +
  geom_line(stat='summary', fun.y = median)
```

Alcohol has a negative correlation with density.

```{r echo=FALSE, alcohol_vs_sulfur_dioxide_chlorides}
p1 <- ggplot(aes(x = alcohol, y = total.sulfur.dioxide), data = wineQuality) +
  geom_line(stat='summary',fun.y=median)
p2 <- ggplot(aes(x = alcohol, y = free.sulfur.dioxide), data = wineQuality) +
  geom_line(stat='summary',fun.y=median)
p3 <- ggplot(aes(x = alcohol, y = chlorides), data = wineQuality) +
  geom_line(stat='summary',fun.y=median)

grid.arrange(p1, p2, p3)
```

Also, alcohol has a negative correlation with total.sulfur.dioxide, free.sulfur.dioxide and chlorides.

```{r echo=FALSE, quality_vs_density}
qplot(y = density, x = quality, data = wineQuality)
ggplot(aes(y = density, x = quality), data = wineQuality) +
  geom_jitter(colour = 'black', fill = 'black',  alpha = 1/6, pch=21, cex=4)
```

```{r echo=FALSE, density_vs_alcohol}
qplot(x = quality_class, y = density, data = wineQuality)
qplot(x = quality_class, y = density, data = wineQuality, geom="boxplot")
```

As quality increases, median of density tends to decrease.

```{r echo=FALSE, quality_class_vs_fixed.acidity}
qplot(x = quality_class, y = fixed.acidity, data = wineQuality)
qplot(x = quality_class, y = fixed.acidity, data = wineQuality, geom="boxplot")
```

There seems to no strong relationship between quality and fixed.acidity.

```{r echo=FALSE, quality_class_vs_volatile.acidity}
qplot(x = quality_class, y = volatile.acidity, data = wineQuality)
qplot(x = quality_class, y = volatile.acidity, data = wineQuality, 
      geom="boxplot")
```

As quality increases, median of volatile.acidity tends to decrease.

```{r echo=FALSE, quality_class_vs_citric.acid}
qplot(x = quality_class, y = citric.acid, data = wineQuality)
qplot(x = quality_class, y = citric.acid, data = wineQuality, geom="boxplot")
```

As quality increases, median of citric.acid tends to increase.

```{r echo=FALSE, citric.acid_and_quality_class}
qplot(citric.acid, data = wineQuality, binwidth = 0.03) +
  facet_wrap(~quality_class)
```

The citric acid has three peaks around 0, 0.25 and 0.5g/dm^3 at each quality.

```{r echo=FALSE, quality_class_vs_residual.sugar}
qplot(x = quality_class, y = residual.sugar, data = wineQuality)
# boxplot with y limit for outliers
qplot(x = quality_class, y = residual.sugar, data = wineQuality, 
      geom="boxplot") +
  coord_cartesian(ylim = c(0, 8))
```

There seems to no strong relationship between quality and residual.sugar

```{r echo=FALSE, quality_class_vs_chlorides}
qplot(x = quality_class, y = chlorides, data = wineQuality)
# boxplot with y limit for outliers
qplot(x = quality_class, y = chlorides, data = wineQuality, geom="boxplot") +
  coord_cartesian(ylim = c(0, 0.25))
```

As quality increases, median of chlorides tends to decrease.

```{r echo=FALSE, quality_class_vs_free.sulfur.dioxide}
qplot(x = quality_class, y = free.sulfur.dioxide, data = wineQuality)
qplot(x = quality_class, y = free.sulfur.dioxide, data = wineQuality, 
      geom="boxplot")
```

There seems to no relationship between quality and free.sulfur.dioxide.

```{r echo=FALSE, quality_class_vs_total.sulfur.dioxide}
qplot(x = quality_class, y = total.sulfur.dioxide, data = wineQuality)
# boxplot with y limit for outliers
qplot(x = quality_class, y = total.sulfur.dioxide, data = wineQuality, 
      geom="boxplot") +
  coord_cartesian(ylim = c(0, 170))
```

There seems to no relationship between quality and total.sulfur.dioxide.

```{r echo=FALSE, quality_class_vs_pH}
qplot(x = quality_class, y = pH, data = wineQuality)
qplot(x = quality_class, y = pH, data = wineQuality, geom="boxplot")
```

As quality increases, median of pH tends to decrease.

```{r echo=FALSE, quality_class_vs_sulphates}
qplot(x = quality_class, y = sulphates, data = wineQuality)
qplot(x = quality_class, y = sulphates, data = wineQuality, geom="boxplot") +
  coord_cartesian(ylim = c(0.3, 1.25))
```

As quality increases, median of sulphates increase

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

Quality correlates with alcohol and sulphates and negatively correlated with volatile.acidity.

Citric.acid distributed with three peaks at 0, 0.25 and 0.5 g/dm^3 at each quality.

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

Alcohol has a negative correlation with density.
Alcohol also has a negative correlation with total.sulfur.dioxide, free.sulfur.dioxide and chlorides.

### What was the strongest relationship you found?

The quality of red wine is positively correlated with alcohol and sulphates and negatively correlated with volatile.acidity.


# Multivariate Plots Section
```{r echo=FALSE, alchol_and_quality_geom_density}
qplot(alcohol, data = wineQuality,
      fill = quality_class)
qplot(alcohol, data = wineQuality,
      color = quality_class, geom = 'density')
```

As quality increases, most of alcohol increse.

```{r echo=FALSE, alcohol_density_and_quality}
ggplot(aes(x = alcohol, y = density), data = wineQuality) +
  geom_jitter(colour = 'black', fill = 'black',  alpha = 1/10, pch=21, cex=4) +
  facet_wrap(~quality_class)

ggplot(aes(x = alcohol, y = density), data = wineQuality) +
  geom_jitter(aes(color=quality_class, bg=quality_class), 
              alpha = 1/4, pch=21, cex=4)
```

Alcohol has a negative correlation with density. 

```{r echo=FALSE, alcohol_pH_and_quality}
qplot(x = alcohol, y = pH, data = wineQuality) +
  facet_wrap(~quality)
ggplot(aes(x = alcohol, y = pH), data = wineQuality) +
  geom_jitter(colour = 'black', fill = 'black',  alpha = 1/10, pch=21, cex=4) +
  facet_wrap(~quality)
```

There seems no specific relation with alchol and pH.

```{r echo=FALSE}
qplot(citric.acid, data = wineQuality, 
      fill = quality_class)
qplot(citric.acid, data = wineQuality, 
      color = quality_class, geom = 'density')
```

In every quality, citric.acid tends to have peaks at 0, 0.25, 0.5 g/dm^3.

```{r echo=FALSE, Build_Linear_Model}
# Remove outliers
wineSubset = subset(wineQuality,
                    alcohol <= quantile(wineQuality$alcohol, 0.999))
# Build linear model for wine quality.
m1 <- lm(quality ~ alcohol,
                    data = wineSubset)
m2 <- update(m1, ~ . + volatile.acidity)
m3 <- update(m2, ~ . + sulphates)
mtable(m1, m2, m3)
```

This linear model has R^2 value 0.341. 
Used three highest absolute correlated variables with quality such as alcohol, volatile.acidity and sulphates.

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

There is a negative correlateion between alcohol and density feature. It can be seen in every quality in red wine data set.

Despite of low R-squared value of 0.341, I built a linear model that pridcit the quality of red wine. 

### Were there any interesting or surprising interactions between features?
From the above the scatter plot of alcohol and pH, there seems to be any specific relations between alcohol and pH.

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.
Yes, I created a linear model using quality and alcohol, volatile.acidity and sulphates. The variables are selected by absolute value of correlation of quality.

The variables in this linear model can account for 34.1% of the variance in the quality of red wines.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}
ggplot(aes(x=citric.acid), data = wineQuality) +
  geom_histogram(fill = I('#099DD9'), binwidth = 0.03) +
  ggtitle('Citric acid histogram ') +
  xlab('citric acid (g / dm^3 )') + 
  ylab('Number of red wine')
```

### Description One
The citric acid has three peaks around 0, 0.25 and 0.5 g/dm^3.
138 red wines have 0 g/dm^3 citric acid which is the highest peak. 

### Plot Two
```{r echo=FALSE, Plot_Two}
theme_set(theme_minimal(12))
# Displaying 3 plots at once.
p1 <- ggplot(aes(x = quality_class, y = alcohol), data = wineQuality)  +
  geom_boxplot() +
  ggtitle('Alcohol by quality') +
  xlab('quality') +
  ylab('alcohol (%)')

p2 <- ggplot(aes(x = quality_class, y = sulphates), data = wineQuality)  +
  geom_boxplot() +
  coord_cartesian(ylim = c(0.3, 1.0)) +
  ggtitle('sulphates by quality') +
  xlab('quality') +
  ylab('sulphates (g / dm^3)')

p3 <- ggplot(aes(x = quality_class, y = volatile.acidity), data = wineQuality) +
  geom_boxplot() +
  ggtitle('volatile.acidity by quality') +
  xlab('quality') +
  ylab('volatile.acidity (g / dm^3)')

grid.arrange(p1, p2, p3, ncol = 2)
```

### Description Two
The quality of red wine is correlated with alcohol and sulphates and negatively correlated with volatile.sulphates.

### Plot Three
```{r echo=FALSE, Plot_Three}
# Replace regend from 'quality_class' to 'quality'. 
# Legend for quality is displayed with descending order.
ggplot(aes(x = alcohol, y = density), data = wineQuality) +
  geom_jitter(aes(color=quality_class, bg=quality_class), 
              alpha = 1/4, pch=21, cex=3) +
  guides(color = guide_legend(reverse = T, title = 'quality'), 
         bg = guide_legend(reverse = T, title = 'quality')) + 
  ggtitle('Relationship between alcohol and density by quality') +
  xlab('alcohol (%)') +
  ylab('density (g / cm^3)')
```

### Description Three
Alcohol has a negative correlation with density. Regardless of quality, density is negatively correlated with alcohol.

------

# Reflection
The data set contains 1599 red variants of the Portuguese "Vinho Verde" wine. I started by understanding the individual variables in the data set, and I was interested in "alcohol" feature because wine is a kind of liquor. 

During the exploring data set, I found interesting distribution with "citric.acid". It has three peaks around 0, 0.25 and 0.5g/dm^3. About 9% of red wine has 0 "citric.acid".

As I expected, the most correlated feature of quality is "alcohol" and there are another features that has relation with quality. "volatile.acidity" is also correlated with quality and "sulphates" is negatively correlated. The linear model with only "alcohol" variable has 0.231 R-sqaured value. By adding "volatile.acidity" and "sulphates", R-squared value is increased with 0.341. 

"alcohol" is negatively correlated with "density" regardless of quality. Percent of "alcohol" is increased, "density" is decreased.

Since the data set consists of samples from the specific red wine mentioned above, there is a limitation of this analysis. It might be interesting to obtain data set from various regions to eliminate any bias created by various products.